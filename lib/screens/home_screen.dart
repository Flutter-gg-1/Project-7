import 'dart:developer';

import 'package:flutter/material.dart';
import 'package:project7/extensions/screen_size.dart';
import 'package:grouped_list/grouped_list.dart';
import 'package:project7/widgets/cards/project_card.dart';

Map<String,dynamic> gg = {
    "msg": "success",
    "data": {
        "count": 5,
        "projects": [
            {
                "project_id": "p-ujg6ra7RdH",
                "type": "app",
                "project_name": null,
                "bootcamp_name": null,
                "start_date": null,
                "end_date": null,
                "presentation_date": null,
                "project_description": null,
                "logo_url": null,
                "presentation_url": null,
                "user_id": "6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6",
                "admin_id": "f86385c7-9913-4ab6-8ce5-42edba6b1f6a",
                "time_end_edit": "2024-12-11",
                "allow_edit": true,
                "allow_rating": true,
                "is_public": true,
                "rating": 0,
                "create_at": "2024-08-05T13:25:32.970673",
                "update_at": "2024-09-13T12:31:07.567473",
                "images_project": [],
                "links_project": [],
                "members_project": []
            },
            {
                "project_id": "p-ujg6ra7RdH",
                "type": "app",
                "project_name": null,
                "bootcamp_name": null,
                "start_date": null,
                "end_date": null,
                "presentation_date": null,
                "project_description": null,
                "logo_url": null,
                "presentation_url": null,
                "user_id": "6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6",
                "admin_id": "f86385c7-9913-4ab6-8ce5-42edba6b1f6a",
                "time_end_edit": "2024-12-11",
                "allow_edit": true,
                "allow_rating": true,
                "is_public": true,
                "rating": 0,
                "create_at": "2024-08-05T13:25:32.970673",
                "update_at": "2024-09-13T12:31:07.567473",
                "images_project": [],
                "links_project": [],
                "members_project": []
            },
            {
                "project_id": "p-JGqY6xjCAK",
                "type": "website",
                "project_name": "Amazing Flutter App",
                "bootcamp_name": "Flutter Bootcamp 2024",
                "start_date": "2024-12-15",
                "end_date": "2024-12-15",
                "presentation_date": "2024-12-15",
                "project_description": "An amazing Flutter app that revolutionizes user experience.",
                "logo_url": "https://cgeahwvmrqwnlsjpfexu.supabase.co/storage/v1/object/public/logo/p-JGqY6xjCAK-logo-92c6c80b-ce3a-41aa-a478-a5933118e20b.png",
                "presentation_url": "https://cgeahwvmrqwnlsjpfexu.supabase.co/storage/v1/object/public/presentation/p-JGqY6xjCAK-p-f6d8c1b9-7a92-4d41-a421-68f44588ba67.pdf",
                "user_id": "6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6",
                "admin_id": "f86385c7-9913-4ab6-8ce5-42edba6b1f6a",
                "time_end_edit": "2024-12-31",
                "allow_edit": true,
                "allow_rating": false,
                "is_public": true,
                "rating": 0,
                "create_at": "2024-08-03T14:48:27.635595",
                "update_at": "2024-09-13T12:31:07.567473",
                "images_project": [
                    {
                        "id": 1,
                        "url": "https://cgeahwvmrqwnlsjpfexu.supabase.co/storage/v1/object/public/project_images/p-JGqY6xjCAK-1-1e62db91-6532-4a1b-b466-7de5d6f88572.png"
                    },
                    {
                        "id": 2,
                        "url": "https://cgeahwvmrqwnlsjpfexu.supabase.co/storage/v1/object/public/project_images/p-JGqY6xjCAK-2-50ca5067-52b0-4a9a-b35e-41d5ffb8e3b3.png"
                    },
                    {
                        "id": 3,
                        "url": "https://cgeahwvmrqwnlsjpfexu.supabase.co/storage/v1/object/public/project_images/p-JGqY6xjCAK-3-7b7d1431-2be8-4642-900c-3c2f0741ea3d.png"
                    }
                ],
                "links_project": [
                    {
                        "url": "https://github.com/example",
                        "type": "github"
                    },
                    {
                        "url": "https://figma.com/example",
                        "type": "figma"
                    },
                    {
                        "url": "https://youtube.com/example",
                        "type": "video"
                    },
                    {
                        "url": "https://appstore.com/example",
                        "type": "pinterest"
                    },
                    {
                        "url": "https://appstore.com/example",
                        "type": "playstore"
                    },
                    {
                        "url": "https://appstore.com/example",
                        "type": "applestore"
                    },
                    {
                        "url": "https://appstore.com/example",
                        "type": "apk"
                    },
                    {
                        "url": "https://appstore.com/example",
                        "type": "weblink"
                    }
                ],
                "members_project": [
                    {
                        "id": "10545b55-4875-441d-88e8-f835acc72374",
                        "first_name": "User",
                        "last_name": "test",
                        "email": "xededa3015@qodiq.com",
                        "position": "Developer",
                        "image_url": null,
                        "link": {}
                    },
                    {
                        "id": "6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6",
                        "first_name": "mohammed",
                        "last_name": "alazmio",
                        "email": "getasa9951@orsbap.com",
                        "position": "ui",
                        "image_url": "https://cgeahwvmrqwnlsjpfexu.supabase.co/storage/v1/object/public/users/6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6-2024-09-13%2006:59:22.143460.png",
                        "link": {
                            "github": "mohammed_19994",
                            "linkedin": "rahaf-alshahrani-20bb67239",
                            "resume": "https://cgeahwvmrqwnlsjpfexu.supabase.co/storage/v1/object/public/resume/6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6-2024-09-13%2006:59:22.143608-cv.pdf",
                            "bindlink": "fahad"
                        }
                    },
                    {
                        "id": "edc41350-526e-40af-97be-2e32a78d55bd",
                        "first_name": "User",
                        "last_name": "test",
                        "email": "tihif93602@qodiq.com",
                        "position": "Developer",
                        "image_url": null,
                        "link": {}
                    }
                ]
            },
            {
                "project_id": "p-9mm91p6NlO",
                "type": "app",
                "project_name": "clean",
                "bootcamp_name": "java",
                "start_date": "2024-12-15",
                "end_date": "2024-12-15",
                "presentation_date": "2024-12-15",
                "project_description": "An amazing Flutter app that revolutionizes user experience.",
                "logo_url": null,
                "presentation_url": null,
                "user_id": "bc3ab1cb-9de6-4ee5-9102-936094c97fea",
                "admin_id": "67b72355-e13a-4deb-93c5-fba424cf7339",
                "time_end_edit": "2024-12-11",
                "allow_edit": true,
                "allow_rating": true,
                "is_public": true,
                "rating": 2.63,
                "create_at": "2024-08-03T14:47:20.125639",
                "update_at": "2024-09-13T12:31:07.567473",
                "images_project": [],
                "links_project": [],
                "members_project": [
                    {
                        "id": "10545b55-4875-441d-88e8-f835acc72374",
                        "first_name": "User",
                        "last_name": "test",
                        "email": "xededa3015@qodiq.com",
                        "position": "Developer",
                        "image_url": null,
                        "link": {}
                    },
                    {
                        "id": "6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6",
                        "first_name": "mohammed",
                        "last_name": "alazmio",
                        "email": "getasa9951@orsbap.com",
                        "position": "ui",
                        "image_url": "https://cgeahwvmrqwnlsjpfexu.supabase.co/storage/v1/object/public/users/6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6-2024-09-13%2006:59:22.143460.png",
                        "link": {
                            "github": "mohammed_19994",
                            "linkedin": "rahaf-alshahrani-20bb67239",
                            "resume": "https://cgeahwvmrqwnlsjpfexu.supabase.co/storage/v1/object/public/resume/6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6-2024-09-13%2006:59:22.143608-cv.pdf",
                            "bindlink": "fahad"
                        }
                    },
                    {
                        "id": "edc41350-526e-40af-97be-2e32a78d55bd",
                        "first_name": "User",
                        "last_name": "test",
                        "email": "tihif93602@qodiq.com",
                        "position": "Developer",
                        "image_url": null,
                        "link": {}
                    }
                ]
            },
            {
                "project_id": "p-V2CEUkBcfd",
                "type": "website",
                "project_name": "hop",
                "bootcamp_name": "java",
                "start_date": "2024-12-15",
                "end_date": "2024-12-15",
                "presentation_date": "2024-12-15",
                "project_description": "An amazing Flutter app that revolutionizes user experience.",
                "logo_url": null,
                "presentation_url": null,
                "user_id": "bc3ab1cb-9de6-4ee5-9102-936094c97fea",
                "admin_id": "67b72355-e13a-4deb-93c5-fba424cf7339",
                "time_end_edit": "2024-12-11",
                "allow_edit": true,
                "allow_rating": true,
                "is_public": true,
                "rating": 2.92,
                "create_at": "2024-08-02T07:05:14.55627",
                "update_at": "2024-09-13T12:31:07.567473",
                "images_project": [],
                "links_project": [],
                "members_project": [
                    {
                        "id": "10545b55-4875-441d-88e8-f835acc72374",
                        "first_name": "User",
                        "last_name": "test",
                        "email": "xededa3015@qodiq.com",
                        "position": "Developer",
                        "image_url": null,
                        "link": {}
                    },
                    {
                        "id": "6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6",
                        "first_name": "mohammed",
                        "last_name": "alazmio",
                        "email": "getasa9951@orsbap.com",
                        "position": "ui",
                        "image_url": "https://cgeahwvmrqwnlsjpfexu.supabase.co/storage/v1/object/public/users/6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6-2024-09-13%2006:59:22.143460.png",
                        "link": {
                            "github": "mohammed_19994",
                            "linkedin": "rahaf-alshahrani-20bb67239",
                            "resume": "https://cgeahwvmrqwnlsjpfexu.supabase.co/storage/v1/object/public/resume/6ca9bc46-217e-48ed-9fde-4b0ff57ad4b6-2024-09-13%2006:59:22.143608-cv.pdf",
                            "bindlink": "fahad"
                        }
                    },
                    {
                        "id": "edc41350-526e-40af-97be-2e32a78d55bd",
                        "first_name": "User",
                        "last_name": "test",
                        "email": "tihif93602@qodiq.com",
                        "position": "Developer",
                        "image_url": null,
                        "link": {}
                    }
                ]
            }
        ]
    }
};
class HomeScreen extends StatelessWidget {
  const HomeScreen({super.key});

  @override
  Widget build(BuildContext context) {
    log(gg['data']['projects'].length.toString());
    log(gg['data']['projects'][0]['bootcamp_name'].toString());
    log(gg['data']['projects'][1]['bootcamp_name'].toString());
    log(gg['data']['projects'][2]['bootcamp_name'].toString());
    log(gg['data']['projects'][3]['bootcamp_name'].toString());
    log(gg['data']['projects'][4]['bootcamp_name'].toString());
    Map<String,int> bootcamps = {};
    for (var element in gg['data']['projects']) {
      if(bootcamps.containsKey(element['bootcamp_name'])) {
        bootcamps[element['bootcamp_name']] = bootcamps[element['bootcamp_name']]! + 1;
      }
      else {
        bootcamps[element['bootcamp_name'].toString()] = 1;
      }
    }
    TextEditingController? controller = TextEditingController();
    return GestureDetector(
      onTap: () => FocusManager.instance.primaryFocus?.unfocus(),
      child: Scaffold(
        body: SafeArea(
          child: Column(
            children: [
              const SizedBox(height: 20,),
              Row(
                children: [
                  Container(
                    margin: const EdgeInsets.symmetric(horizontal: 14),
                    width: context.getWidth() / 1.2,
                    height: 46,
                    child: TextFormField(
                      controller: controller,
                      decoration: const InputDecoration(
                      contentPadding: EdgeInsets.symmetric(horizontal: 16),
                        border: OutlineInputBorder(
                          borderSide: BorderSide(color: Color(0xff4D2EB4), width: .5),
                          borderRadius: BorderRadius.all(Radius.circular(6))
                        ),
                      ),
                    )
                  ),
                  const Icon(Icons.filter_alt, color: Color(0xff4d2eb4),)
                ],
              ),
              const SizedBox(height: 44,),
              // list to store all projects, groupby ['bootcamp_name']
              Expanded(
                child: Padding(
                  padding: const EdgeInsets.symmetric(horizontal: 10),
                  child: GroupedListView(
                    elements: List.from(gg['data']['projects']),
                    groupBy: (e)=> e?['bootcamp_name'] ?? 'null',
                    itemBuilder: (context, element) => Column(
                      children: [GridView(
                        physics: const NeverScrollableScrollPhysics(),
                        shrinkWrap: true,
                        gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(crossAxisCount: 2),
                        children: List.generate(bootcamps[element['bootcamp_name'].toString()]!, (index){
                          return ProjectCard();
                        }),
                      )],
                    ),
                    groupSeparatorBuilder: (value) => Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        const SizedBox(height: 10,),
                        Row(
                          mainAxisAlignment: MainAxisAlignment.spaceBetween,
                          children: [
                            Text(value, style: const TextStyle(fontFamily: 'Lato', fontSize: 20, fontWeight: FontWeight.w700),),
                            Row(
                              children: [
                                Text("view all"),
                                SizedBox(width: 10,),
                                Icon(Icons.arrow_forward_ios_outlined, size: 16,),
                              ],
                            )
                          ],
                        ),
                        const Divider(),
                      ],
                    ),
                  ),
                ),
              ),
            ],
          ),
        )
      ),
    );
  }
}